var validate;

validate = (function (_this) {
    return function (value, options, readFormat) {
        var valueDate;
        if (value && (moment(value).isValid() || moment(value, readFormat).isValid())) {
            if (moment(value, readFormat).isValid()) {
                valueDate = moment(value, readFormat);
            } else if (moment(value).isValid()) {
                valueDate = moment(value);
            }
            if (options == null) {
                return valueDate;
            }
            if ((options.min != null) && (options.max == null)) {
                if (valueDate.isAfter(options.min) || valueDate.isSame(options.min)) {
                    return valueDate;
                }
                return null;
            } else if ((options.max != null) && (options.min == null)) {
                if (valueDate.isBefore(options.max) || valueDate.isSame(options.max)) {
                    return valueDate;
                }
                return null;
            } else if ((options.max != null) && (options.min != null)) {
                if ((valueDate.isBefore(options.max) || valueDate.isSame(options.max)) && (valueDate.isAfter(options.min) || valueDate.isSame(options.min))) {
                    return valueDate;
                }
                return null;
            } else if (!((options.min != null) && (options.max != null))) {
                return valueDate;
            }
        }
        return null;
    };
})(this);

ko.bindingHandlers.pickadate = {
    init: function (element, valueAccessor, allBindingsAccessor) {
        var $element, $input, $parent, observable, options, picker, readFormat, validValue, value;
        observable = valueAccessor();
        if (!_.isFunction(observable.componentUpdate)) {
            observable.withComponent();
        }
        value = observable();
        $element = $(element);
        options = ko.unwrap(allBindingsAccessor.get('pickadateOptions'));
        readFormat = allBindingsAccessor.get('readFormat');
        $input = $element.pickadate(options);
        picker = $input.pickadate('picker');
        validValue = validate(value, options, readFormat);
        if (validValue != null) {
            picker.set('select', validValue.toDate());
        }
        picker.on("set", function (data) {
            var date;
            if (data.select) {
                date = moment(data.select);
                return observable.componentUpdate(date.toDate());
            } else {
                return observable.componentUpdate(null);
            }
        });
        $parent = $element.parent();
        if (options != null ? options.appendButtonSelector : void 0) {
            return $(options != null ? options.appendButtonSelector : void 0, $parent).click(function (event) {
                event.stopPropagation();
                return picker.open();
            });
        }
    },
    update: function (element, valueAccessor, allBindingsAccessor) {
        var observable, options, picker, readFormat, validValue, value;
        observable = valueAccessor();
        value = observable();
        options = ko.unwrap(allBindingsAccessor.get('pickadateOptions'));
        readFormat = allBindingsAccessor.get('readFormat');
        if (_.isFunction(observable.isModifiedByComponent) && observable.isModifiedByComponent()) {
            return;
        }
        picker = $(element).pickadate('picker');
        validValue = validate(value, options, readFormat);
        if (validValue != null) {
            return picker.set('select', validValue.toDate());
        } else {
            return picker.clear();
        }
    }
};

// ---
// generated by coffee-script 1.9.0